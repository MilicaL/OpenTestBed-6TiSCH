# -*- coding: utf-8 -*-

import datetime

motes = ['d273',
        'd288',
        'd2a1',
        'd2a7',
        'd2b1',
        'd2e2',
        'd2f0',
        'd2fb',
        'd309',
        'd316',
        'd326',
        'd31a',
        'd32a',
        'd332',
        'd34b',
        'd34d',
        'd34e',
        'd352',
        'd354',
        'd360',
        'd370']

num_motes = 0

class AA(object):
    count = 0
    mean = 0
    std = 0
    minimum = 0
    dp = 0
    p = 0
    sp = 0
    maximum = 0
    
    def ispis(self, a):
        print('count:', end = ' ')
        print(self.count / a)
        
        print('mean:', end = ' ')
        print(self.mean / a)
        
        print('std:', end = ' ')
        print(self.std / a)
        
        print('min:', end = ' ')
        print(self.minimum / a)
        
        print('25%:', end = ' ')
        print(self.dp / a)
        
        print('50%:', end = ' ')
        print(self.p / a)
        
        print('75%:', end = ' ')
        print(self.sp / a)
        
        print('max:', end = ' ')
        print(self.maximum / a)



stat = {'>>> Total packets arrived:' : 0,
        '>>> Total missing packets (between first and last arrived packet):' : 0,
        '>>> Calculated PDR in %:' : 0,
        '>>> Total time between 1st and last pkt arrived:' : 0,
        '>>> Packets delay stats (in ms):' : AA(),
        '>>> Packets delay stats (in time slots):' : AA(),
        '>>> Period (in seconds) between consecutive uinject packets stats:' : AA(),
        '>>> Number of duplicated packets:' : 0,
        '>>> Number of out-of-order arrived packets:' : 0,
        '>>> Duty Cycle stats:' : AA(),
        '>>> numCellsUsedRx stats:' : AA(),
        '>>> numCellsUsedTx stats:' : AA(),
        'days' : 0,
        'hours' : 0,
        'mins' : 0,
        'secs' : 0}

single_stat = ['>>> Total packets arrived:',
        '>>> Total missing packets (between first and last arrived packet):',
        '>>> Calculated PDR in %:',
        #'>>> Total time between 1st and last pkt arrived:' : 0,
        '>>> Number of duplicated packets:',
        '>>> Number of out-of-order arrived packets:']


with open('fsk.txt', encoding = 'utf-8') as f:
    for a in f:
        a = a.strip()
        if a in motes:
            num_motes += 1
            
        elif a in stat:
            if a in single_stat:
                aa = float(f.readline().strip())
                stat[a] += aa
            elif a == '>>> Total time between 1st and last pkt arrived:':
                aa = f.readline().strip()
                aa = aa.split()
                stat['days'] += float(aa[0])
                
                bb = aa[2].split(':')
                stat['hours'] += float(bb[0])
                stat['mins'] += float(bb[1])
                stat['secs'] += float(bb[2])
            else:
                stat[a].count += float(f.readline().strip().split()[1])
                stat[a].mean += float(f.readline().strip().split()[1])
                stat[a].std += float(f.readline().strip().split()[1])
                stat[a].minimum += float(f.readline().strip().split()[1])
                stat[a].dp += float(f.readline().strip().split()[1])
                stat[a].p += float(f.readline().strip().split()[1])
                stat[a].sp += float(f.readline().strip().split()[1])
                stat[a].maximum += float(f.readline().strip().split()[1])

print('Total motes', end = ' ')
print(num_motes)
print('-------------------------')

print('Total packets arrived:', end = ' ')
print(stat['>>> Total packets arrived:'] / num_motes)
print('-------------------------')

print('Total missing packets (between first and last arrived packet):', end = ' ')
print(stat['>>> Total missing packets (between first and last arrived packet):'] / num_motes)
print('-------------------------')

print('Calculated PDR in %:', end = ' ')
print(stat['>>> Calculated PDR in %:'] / num_motes)
print('-------------------------')

print('Total time between 1st and last pkt arrived:', end = ' ')
print(str(datetime.timedelta(seconds = ((stat['days'] * 24 + stat['hours']) * 3600 + stat['mins'] * 60 + stat['secs']) / num_motes)))
print('-------------------------')

print('Packets delay stats (in ms):')
stat['>>> Packets delay stats (in ms):'].ispis(num_motes)
print('-------------------------')

print('Packets delay stats (in time slots):')
stat['>>> Packets delay stats (in time slots):'].ispis(num_motes)
print('-------------------------')

print('Period (in seconds) between consecutive uinject packets stats:')
stat['>>> Period (in seconds) between consecutive uinject packets stats:'].ispis(num_motes)
print('-------------------------')

print('Number of duplicated packets:', end = ' ')
print(stat['>>> Number of duplicated packets:'] / num_motes)
print('-------------------------')

print('Number of out-of-order arrived packets:', end = ' ')
print(stat['>>> Number of out-of-order arrived packets:'] / num_motes)
print('-------------------------')

print('Duty Cycle stats:')
stat['>>> Duty Cycle stats:'].ispis(num_motes)
print('-------------------------')

print('numCellsUsedRx stats:')
stat['>>> numCellsUsedRx stats:'].ispis(num_motes)
print('-------------------------')

print('numCellsUsedTx stats:')
stat['>>> numCellsUsedTx stats:'].ispis(num_motes)
